$.fn.GigaTable.Editor=function(e){function t(e){T.buttons.editor_edit='<div class="gte_button edit gte_btn_disabled"><span>gte.button.editor_edit</span></div>',T.buttons.editor_create='<div class="gte_button create"><span>gte.button.editor_create</span></div>',T.buttons.editor_remove='<div class="gte_button remove gte_btn_disabled"><span>gte.button.editor_remove</span></div>'}function i(e){var t="",i="",P="",j="";if(typeof e.fields===a)return void console.err('You should define "fields" option.');if(0===typeof e.fields.length)return void console.err('You should define at least one field in "fields" option.');var E=e.fields,I="",S="";for(var $ in E){var C=E[$].type,O=E[$].name,U=E[$].label,A="";if(typeof E[$].attrs!==a){var L=E[$].attrs;for(var R in L)for(var D in L[R])A+=D+'="'+L[R][D]+'"'}switch(C){case s:case c:case p:case v:case _:case f:case u:case g:case b:case m:case h:case y:case w:case x:case k:case r:I+='<div class="gte_editor_fields">',S+='<div class="gte_editor_fields">',"hidden"!==C&&(I+='<label class="gte_label" for="'+O+'">'+U+"</label>",S+='<label class="gte_label" for="'+O+'">'+U+"</label>"),I+='<div class="gte_field"><input '+A+' id="'+O+'" type="'+C+'" name="'+O+'" data-value=""/></div><div class="clear"></div></div>',S+='<div class="gte_field"><input '+A+' id="'+O+'" type="'+C+'" name="'+O+'" data-value=""/></div><div class="clear"></div></div>';break;case l:I+='<div class="gte_editor_fields"><label class="gte_label" for="'+O+'">'+U+'</label><div class="gte_field"><textarea '+A+' id="'+O+'" name="'+O+'"></textarea></div><div class="clear"></div></div>',S+='<div class="gte_editor_fields"><label class="gte_label" for="'+O+'">'+U+'</label><div class="gte_field"><textarea '+A+' id="'+O+'" name="'+O+'"></textarea></div><div class="clear"></div></div>';break;case o:var F=E[$].values,G="",Y="";for(var $ in F)for(var z in F[$])Y=F[$][z].trim(),G+='<option value="'+z+'" data-value="'+Y.toLowerCase()+'">'+Y+"</option>";I+='<div class="gte_editor_fields"><label class="gte_label" for="'+O+'">'+U+'</label><div class="gte_field"><select '+A+' id="'+O+'" name="'+O+'">'+G+'</select></div><div class="clear"></div></div>',S+='<div class="gte_editor_fields"><label class="gte_label" for="'+O+'">'+U+'</label><div class="gte_field"><select '+A+' id="'+O+'" name="'+O+'">'+G+'</select></div><div class="clear"></div></div>';break;case d:case n:var F=E[$].values,G="",Y="";for(var $ in F)for(var z in F[$])Y=F[$][z].trim(),G+='<label class="gte_label_text"><input '+A+' id="'+O+'" type="'+C+'" name="'+O+'" data-value="'+Y.toLowerCase()+'">'+Y+"</label>";I+='<div class="gte_editor_fields"><label class="gte_label">'+U+'</label><div class="gte_field">'+G+'</div><div class="clear"></div></div>',S+='<div class="gte_editor_fields"><label class="gte_label">'+U+'</label><div class="gte_field">'+G+'</div><div class="clear"></div></div>'}}t='<div class="gte_editor_popup"><div class="gte_popup_container"><div class="gte_popup_container_wrapper"><div class="gte_form_border_box"><div class="gte_form_fields"><div class="gte_header"><div class="gte_editor_title">gte.editor.popupheader.create</div></div><div class="gte_form_body"><div class="gte_form_body_content"><form id="gte_form" action="" method="post"><div class="gte_form_content"><div><input type="hidden" name="action" value="create"/></div>'+I+'</div></form></div></div><div class="gte_footer"><div class="gte_form_err"></div><div class="gte_form_buttons"><button id="gte_sent_btn" class="btn">gte.editor.btn.create</button></div></div></div></div></div></div></div>',i='<div class="gte_editor_popup"><div class="gte_popup_container"><div class="gte_popup_container_wrapper"><div class="gte_form_border_box"><div class="gte_form_fields"><div class="gte_header"><div class="gte_editor_title">gte.editor.popupheader.edit</div></div><div class="gte_form_body"><div class="gte_form_body_content"><form id="gte_form" action="" method="post"><div class="gte_form_content"><div><input type="hidden" name="action" value="edit"/></div>'+S+'</div></form></div></div><div class="gte_footer"><div class="gte_form_err"></div><div class="gte_form_buttons"><button id="gte_sent_btn" class="btn">gte.editor.btn.edit</button></div></div></div></div></div></div></div>',P='<div class="gte_editor_popup"><div class="gte_popup_container"><div class="gte_popup_container_wrapper"><div class="gte_form_border_box"><div class="gte_form_fields"><div class="gte_header"><div class="gte_editor_title">gte.editor.popupheader.delete</div></div><div class="gte_form_body"><div class="gte_form_body_content"><form id="gte_form" action="" method="post"><div class="gte_form_content"><div><input type="hidden" name="action" value="delete"/></div><div id="gte_ids"></div><div id="gte_msg"></div></div></form></div></div><div class="gte_footer"><div class="gte_form_err"></div><div class="gte_form_buttons"><button id="gte_sent_btn" class="btn">gte.editor.btn.delete</button></div></div></div></div></div></div></div>',j='<div class="gte_popup_background"></div>',T.popup.create=t,T.popup.edit=i,T.popup["delete"]=P,T.popup.background=j}var a="undefined",d="checkbox",o="select",n="radio",s="text",r="file",l="textarea",c="hidden",p="email",v="password",_="color",f="date",u="datetime",g="number",b="range",m="search",h="time",y="tel",w="url",x="month",k="week",P=27,j=13,E="create",I="edit",S="delete",T={editorSettings:{},popupWindow:null,popupBg:null,struct:{},buttons:{},popup:{},hidePopUp:function(e){var t=e.container.find(".gte_popup_background"),i=e.container.find(".gte_editor_popup");i.animate({opacity:0,top:"50px"},300),i.fadeOut(300),t.fadeOut(300,function(){t.remove(),i.remove()})},hidePopupEvents:function(e){var t=this,i=e.container.find(".gte_popup_background"),a=e.container.find(".gte_editor_popup");i.click(function(i){t.hidePopUp(e)}),$(document).keydown(function(i){i.which===P&&t.hidePopUp(e)}),a.find(".close").click(function(){t.hidePopUp(e)}),e.container.find("#gte_form input, textarea, select").keydown(function(e){e.stopPropagation(),e.stopImmediatePropagation()})},sendAjaxEvent:function(e,t){var i=this,d=e.container.find("#gte_form"),o=e.container.find("#gte_sent_btn");if(typeof d.find("input[file]")!==a){var n=[],s=0;d.find('input[type="file"]').on("change",function(e){n[s++]=e.target.files})}o.click(function(){if(typeof n!==a&&null!==n){var o=T.editorSettings.ajaxFiles;if(o===a||null===o||""===o)return void console.error("You should secify ajaxFiles url to upload files on server.");var s=new FormData;$.each(n,function(e,t){$.each(t,function(t,i){s.append(e,i)})}),$.ajax({url:o,type:"POST",data:s,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(e){})}var r=d.serialize();$.ajax({url:i.editorSettings.ajax,type:"POST",data:r,dataType:"json"}).done(function(d){if(t===E){var o=e.columns,n=0,s="<tr ";typeof d.row.GT_RowId!==a?(n=d.row.GT_RowId,s+=' gte-row-id="'+n+'" '):typeof d.row.id!==a&&(n=d.row.id,s+=' gte-row-id="'+n+'" '),s+=">";for(var r in o)s+='<td data-name="'+o[r].data+'">'+d.row[o[r].data]+"</td>";s+="</tr>",e.container.find("tbody").prepend(s),e.setSelectedRows(e,1)}else if(t===I){var l=e.container.find("tbody"),o=e.columns,s=l.find("tr.active"),c="";for(var r in o)c+='<td data-name="'+o[r].data+'">'+d.row[o[r].data]+"</td>";s.html(c),e.setSelectedRows(e,1)}else if(t===S){var p=e.container.find('#gte_form input[name^="ids"]');p.each(function(){e.container.find("tbody tr[gte-row-id="+$(this).val()+"]").remove()})}i.hidePopUp(e)})}),$(document).keydown(function(e){e.which===j&&o.trigger("click")})},triggerPopupCreate:function(e){e.container.append(this.popup.create),e.container.append(this.popup.background);var t=e.container.find(".gte_editor_popup"),i=e.container.find(".gte_popup_background");t.show(),t.animate({opacity:1,top:"-20px"},300),t.fadeIn(300),i.fadeIn(300),this.hidePopupEvents(e),this.sendAjaxEvent(e,E)},triggerPopupEdit:function(e){var t=null,i=null,a=null,d=null;e.container.append(this.popup.edit),e.container.append(this.popup.background);var o=e.container.find(".gte_editor_popup"),n=e.container.find(".gte_popup_background"),s=this.editorSettings.fields,c=e.tbody.find("tr.active");for(var p in s)if(i=s[p].name,a=s[p].type,t=c.children('td[data-name="'+i+'"]'),d=t.text().trim(),t.length>0&&a!==r){var v=["select","checkbox","radio"];-1!==v.indexOf(a)?"select"===a?o.find(a+'[name="'+i+'"] option[data-value="'+d.toLowerCase()+'"]').attr("selected",!0):o.find('input[name="'+i+'"][data-value="'+d.toLowerCase()+'"]').attr("checked",!0):o.find('input[name="'+i+'"]').val(d),a===l&&o.find(l+'[name="'+i+'"]').text(d)}o.show(),o.animate({opacity:1,top:"-20px"},300),o.fadeIn(300),n.fadeIn(300),this.hidePopupEvents(e),this.sendAjaxEvent(e,I)},triggerPopupDelete:function(e){e.container.append(this.popup["delete"]),e.container.append(this.popup.background);var t=e.container.find(".gte_editor_popup"),i=e.container.find(".gte_popup_background");t.show(),t.animate({opacity:1,top:"-20px"},300),t.fadeIn(300),i.fadeIn(300),this.hidePopupEvents(e),this.sendAjaxEvent(e,S)}},C=$.extend(!0,{struct:T.struct},e);return T.editorSettings=C,t(C),i(C),T};