$.fn.GigaTable.Editor=function(e){function t(e){k.buttons.editor_edit='<div class="gte_button edit gte_btn_disabled"><span>gte.button.editor_edit</span></div>',k.buttons.editor_create='<div class="gte_button create"><span>gte.button.editor_create</span></div>',k.buttons.editor_remove='<div class="gte_button remove gte_btn_disabled"><span>gte.button.editor_remove</span></div>'}function i(e){var t="",i="",P="",j="";if("undefined"==typeof e.fields)return void console.err('You should define "fields" option.');if(0===typeof e.fields.length)return void console.err('You should define at least one field in "fields" option.');var E=e.fields,I="",T="";for(var $ in E){var S=E[$].type,C=E[$].name,O=E[$].label;switch(S){case n:case l:case c:case p:case v:case _:case f:case u:case g:case b:case m:case h:case y:case w:case x:case s:I+='<div class="gte_editor_fields">',T+='<div class="gte_editor_fields">',"hidden"!==S&&(I+='<label class="gte_label" for="'+C+'">'+O+"</label>",T+='<label class="gte_label" for="'+C+'">'+O+"</label>"),I+='<div class="gte_field"><input id="'+C+'" type="'+S+'" name="'+C+'" data-value=""/></div><div class="clear"></div></div>',T+='<div class="gte_field"><input id="'+C+'" type="'+S+'" name="'+C+'" data-value=""/></div><div class="clear"></div></div>';break;case r:I+='<div class="gte_editor_fields"><label class="gte_label" for="'+C+'">'+O+'</label><div class="gte_field"><textarea id="'+C+'" name="'+C+'"></textarea></div><div class="clear"></div></div>',T+='<div class="gte_editor_fields"><label class="gte_label" for="'+C+'">'+O+'</label><div class="gte_field"><textarea id="'+C+'" name="'+C+'"></textarea></div><div class="clear"></div></div>';break;case a:var U=E[$].values,A="",G="";for(var $ in U)for(var L in U[$])G=U[$][L].trim(),A+='<option value="'+L+'" data-value="'+G.toLowerCase()+'">'+G+"</option>";I+='<div class="gte_editor_fields"><label class="gte_label" for="'+C+'">'+O+'</label><div class="gte_field"><select id="'+C+'" name="'+C+'">'+A+'</select></div><div class="clear"></div></div>',T+='<div class="gte_editor_fields"><label class="gte_label" for="'+C+'">'+O+'</label><div class="gte_field"><select id="'+C+'" name="'+C+'">'+A+'</select></div><div class="clear"></div></div>';break;case d:case o:var U=E[$].values,A="",G="";for(var $ in U)for(var L in U[$])G=U[$][L].trim(),A+='<label class="gte_label_text"><input id="'+C+'" type="'+S+'" name="'+C+'" data-value="'+G.toLowerCase()+'">'+G+"</label>";I+='<div class="gte_editor_fields"><label class="gte_label">'+O+'</label><div class="gte_field">'+A+'</div><div class="clear"></div></div>',T+='<div class="gte_editor_fields"><label class="gte_label">'+O+'</label><div class="gte_field">'+A+'</div><div class="clear"></div></div>'}}t='<div class="gte_editor_popup"><div class="gte_popup_container"><div class="gte_popup_container_wrapper"><div class="gte_form_border_box"><div class="gte_form_fields"><div class="gte_header"><div class="gte_editor_title">gte.editor.popupheader.create</div></div><div class="gte_form_body"><div class="gte_form_body_content"><form id="gte_form" action="" method="post"><div class="gte_form_content"><div><input type="hidden" name="action" value="create"/></div>'+I+'</div></form></div></div><div class="gte_footer"><div class="gte_form_err"></div><div class="gte_form_buttons"><button id="gte_sent_btn" class="btn">gte.editor.btn.create</button></div></div></div></div></div></div></div>',i='<div class="gte_editor_popup"><div class="gte_popup_container"><div class="gte_popup_container_wrapper"><div class="gte_form_border_box"><div class="gte_form_fields"><div class="gte_header"><div class="gte_editor_title">gte.editor.popupheader.edit</div></div><div class="gte_form_body"><div class="gte_form_body_content"><form id="gte_form" action="" method="post"><div class="gte_form_content"><div><input type="hidden" name="action" value="edit"/></div>'+T+'</div></form></div></div><div class="gte_footer"><div class="gte_form_err"></div><div class="gte_form_buttons"><button id="gte_sent_btn" class="btn">gte.editor.btn.edit</button></div></div></div></div></div></div></div>',P='<div class="gte_editor_popup"><div class="gte_popup_container"><div class="gte_popup_container_wrapper"><div class="gte_form_border_box"><div class="gte_form_fields"><div class="gte_header"><div class="gte_editor_title">gte.editor.popupheader.delete</div></div><div class="gte_form_body"><div class="gte_form_body_content"><form id="gte_form" action="" method="post"><div class="gte_form_content"><div><input type="hidden" name="action" value="delete"/></div><div id="gte_ids"></div><div id="gte_msg"></div></div></form></div></div><div class="gte_footer"><div class="gte_form_err"></div><div class="gte_form_buttons"><button id="gte_sent_btn" class="btn">gte.editor.btn.delete</button></div></div></div></div></div></div></div>',j='<div class="gte_popup_background"></div>',k.popup.create=t,k.popup.edit=i,k.popup["delete"]=P,k.popup.background=j}var d="checkbox",a="select",o="radio",n="text",s="file",r="textarea",l="hidden",c="email",p="password",v="color",_="date",f="datetime",u="number",g="range",b="search",m="time",h="tel",y="url",w="month",x="week",k={editorSettings:{},popupWindow:null,popupBg:null,struct:{},buttons:{},popup:{},hidePopUp:function(e){var t=e.container.find(".gte_popup_background"),i=e.container.find(".gte_editor_popup");i.animate({opacity:0,top:"50px"},300),i.fadeOut(300),t.fadeOut(300,function(){t.remove(),i.remove()})},hidePopupEvents:function(e){var t=this,i=e.container.find(".gte_popup_background"),d=e.container.find(".gte_editor_popup");i.click(function(i){t.hidePopUp(e)}),$(document).keydown(function(i){t.hidePopUp(e)}),d.find(".close").click(function(){t.hidePopUp(e)}),e.container.find("#gte_form input, textarea, select").keydown(function(e){e.stopPropagation(),e.stopImmediatePropagation()})},sendAjaxEvent:function(e,t){var i=this,d=e.container.find("#gte_form");if("undefined"!=typeof d.find("input[file]")){var a=[],o=0;d.find('input[type="file"]').on("change",function(e){a[o++]=e.target.files})}e.container.find("#gte_sent_btn").click(function(){if("undefined"!=typeof a&&null!==a){var o=k.editorSettings.ajaxFiles;if("undefined"===o||null===o||""===o)return void console.error("You should secify ajaxFiles url to upload files on server.");var n=new FormData;$.each(a,function(e,t){$.each(t,function(t,i){n.append(e,i)})}),$.ajax({url:o,type:"POST",data:n,cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(e){})}var s=d.serialize();$.ajax({url:i.editorSettings.ajax,type:"POST",data:s,dataType:"json"}).done(function(d){if("create"===t){var a=e.container.find("tbody"),o=e.columns,n=0,s="<tr ";"undefined"!=typeof d.row.GT_RowId?(n=d.row.GT_RowId,s+=' gte-row-id="'+n+'" '):"undefined"!=typeof d.row.GT_RowId&&(n=d.row.id,s+=' gte-row-id="'+n+'" '),s+=">";for(var r in o)s+="<td>"+d.row[o[r].data]+"</td>";s+="</tr>",a.prepend(s)}else if("edit"===t){var a=e.container.find("tbody"),o=e.columns,s=a.find("tr.active"),l="";for(var r in o)l+="<td>"+d.row[o[r].data]+"</td>";s.html(l)}else if("delete"===t){var c=e.container.find('#gte_form input[name^="ids"]');c.each(function(){e.container.find("tbody tr[gte-row-id="+$(this).val()+"]").remove()})}i.hidePopUp(e)})})},triggerPopupCreate:function(e){e.container.append(this.popup.create),e.container.append(this.popup.background);var t=e.container.find(".gte_editor_popup"),i=e.container.find(".gte_popup_background");t.show(),t.animate({opacity:1,top:"-20px"},300),t.fadeIn(300),i.fadeIn(300),this.hidePopupEvents(e),this.sendAjaxEvent(e,"create")},triggerPopupEdit:function(e){var t=null,i=null,d=null,a=null;e.container.append(this.popup.edit),e.container.append(this.popup.background);var o=e.container.find(".gte_editor_popup"),n=e.container.find(".gte_popup_background"),s=this.editorSettings.fields,r=e.tbody.find("tr.active");for(var l in s)if(i=s[l].name,d=s[l].type,t=r.children('td[data-name="'+i+'"]'),a=t.text().trim(),t.length>0&&"file"!==d){var c=["select","checkbox","radio"];-1!==c.indexOf(d)?"select"===d?o.find(d+'[name="'+i+'"] option[data-value="'+a.toLowerCase()+'"]').attr("selected",!0):o.find('input[name="'+i+'"][data-value="'+a.toLowerCase()+'"]').attr("checked",!0):o.find('input[name="'+i+'"]').val(a)}o.show(),o.animate({opacity:1,top:"-20px"},300),o.fadeIn(300),n.fadeIn(300),this.hidePopupEvents(e),this.sendAjaxEvent(e,"edit")},triggerPopupDelete:function(e){e.container.append(this.popup["delete"]),e.container.append(this.popup.background);var t=e.container.find(".gte_editor_popup"),i=e.container.find(".gte_popup_background");t.show(),t.animate({opacity:1,top:"-20px"},300),t.fadeIn(300),i.fadeIn(300),this.hidePopupEvents(e),this.sendAjaxEvent(e,"delete")}},P=$.extend(!0,{struct:k.struct},e);return k.editorSettings=P,t(P),i(P),k};