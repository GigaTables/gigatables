!function($){String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),$.fn.GigaTable=function(options){function setButtons(settings){var buttons=settings.tableOpts.buttons.sort(function(e,t){return t.extended.localeCompare(e.extended)}),btnsCnt=settings.tableOpts.buttons.length,editorObj=buttons[0].editor;if(typeof buttons!==UNDEFINED&&btnsCnt>0){var button=null;for(var k in buttons)button=buttons[k].editor.buttons[buttons[k].extended],$.inArray("top",settings.tableOpts.buttonsPosition)>=0&&settings.headTools.prepend('<div class="gte_buttons_container">'+button.replace("gte.button."+buttons[k].extended,eval("language."+buttons[k].extended))+'<div class="clear"></div></div>'),$.inArray("bottom",settings.tableOpts.buttonsPosition)>=0&&settings.footTools.prepend('<div class="gte_buttons_container">'+button.replace("gte.button."+buttons[k].extended,eval("language."+buttons[k].extended))+'<div class="clear"></div></div>');settings.headTools.find(".gte_button.create").click(function(){editorObj.triggerPopupCreate(settings);var e=settings.container.find(".gte_editor_popup");e.find(".gte_editor_title").text(language.gte_editor_popupheader_create),e.find("#gte_sent_btn").text(language.gte_editor_sendbtn_create)}),settings.footTools.find(".gte_button.create").click(function(){editorObj.triggerPopupCreate(settings);var e=settings.container.find(".gte_editor_popup");e.find(".gte_editor_title").text(language.gte_editor_popupheader_create),e.find("#gte_sent_btn").text(language.gte_editor_sendbtn_create)})}}function setSort(settings,json){var ths=settings.container.find("th"),i=0,c=ths.length/2;ths.each(function(){var that=$(this),idx=that.index();settings.columns[idx].sortable!==!1&&(settings.columns[idx].discreteSearch!==!0||settings.columns[idx].discreteSearch===!0&&c>i)&&that.click(function(){sortTimeout=setTimeout(function(){var objTh=that,idx=objTh.index(),nJson=json,cols=settings.columns,sortingOrder=0;objTh.hasClass("sorting")||objTh.hasClass("sorting_desc")?(ths.eq(idx).removeClass("sorting").removeClass("sorting_desc").addClass("sorting_asc"),ths.eq(idx+cols.length).removeClass("sorting").removeClass("sorting_desc").addClass("sorting_asc"),sortingOrder=1):(sortingOrder=-1,ths.eq(idx).removeClass("sorting_asc").addClass("sorting_desc"),ths.eq(idx+cols.length).removeClass("sorting_asc").addClass("sorting_desc"));var isNan=0,check=0;nJson.sort(function(a,b){return a=eval("a."+cols[idx].data)+"",b=eval("b."+cols[idx].data)+"",0===check&&(isNaN(a-b)&&(isNan=1),check=1),1===sortingOrder?1&isNan?a.localeCompare(b):a-b:1&isNan?b.localeCompare(a):b-a}),setTableSort(settings,nJson)},50)}),++i})}function setSearch(e,t){var s=!1;e.container.find(".gt_search").keyup(function(){var o=$(this),n=o.val(),a=n.length;nowMillis=(new Date).getTime();var i=nowMillis-lastTimeKeyup;if(i>PERIOD_SEARCH&&a>0||0===a&&""===n){if(s===!0&&""===n)return;if(s===!1&&""===n)return setTableRows(e,t),void(s=!0);var r=[],d="",l=0;for(var c in t)for(var g in t[c])if("GT_RowId"!==g&&unsearchableCols[g]===!0&&(d=t[c][g]+"",-1!==d.indexOf(n))){r[l]=t[c],++l;break}setTableRows(e,t,r),s=!1}lastTimeKeyup=nowMillis})}function setDiscreteSearch(e,t){e.tfoot.find("th input").keyup(function(){var s=$(this),o=s.val(),n=s.parent().index();searchTimeout=setTimeout(function(){if(o.length>1||0===o.length&&""===o){if(""===o)return void setTableRows(e,t);var s=[],a="",i=0;for(var r in t)for(var d in t[r])if("GT_RowId"!==d&&unsearchableCols[d]===!0&&e.columns[n].data===d&&(a=t[r][d]+"",-1!==a.indexOf(o))){s[i]=t[r],++i;break}setTableRows(e,t,s)}},300)})}function setPgnSelect(e,t){if(typeof e.headTools!==UNDEFINED){var s=e.container.find(".gt_select");s.change(function(){settings.defaultPerPage=$(this).val(),settings.fromRow=0,setTableRows(settings,t),s.find("option").prop(SELECTED,!1),s.find('option[value="'+settings.defaultPerPage+'"]').prop(SELECTED,!0)})}}function drawPagnButtons(e,t,s){for(var o=5,n="",a="",i=0,r=0,d=0,l=t/s+1,c=parseInt(e)-o,g=0;e>g;++g){i=g*s;var _=g-1,u=g+1;if(l===u&&(r=_*s,0>_&&(r=(e-1)*s),d=u*s,u===e&&(d=0)),g>o){if(o>l){n+='<div class="gt_page_dots">...</div>',g+1===e&&(a=SELECTED),n+='<div data-from="'+(e-1)*s+'" class="gt_page '+a+'">'+e+"</div>";break}if(l>=o&&e-o>=l){_=l-1,u=l+1,n='<div data-from="0" class="gt_page">1</div>',n+='<div class="gt_page_dots">...</div>',r=(l-2)*s,d=l*s,n+='<div data-from="'+r+'" class="gt_page">'+(l-1)+"</div>",n+='<div data-from="'+(l-1)*s+'" class="gt_page selected">'+l+"</div>",n+='<div data-from="'+d+'" class="gt_page">'+(l+1)+"</div>",n+='<div class="gt_page_dots">...</div>',n+='<div data-from="'+(e-1)*s+'" class="gt_page">'+e+"</div>";break}if(l>c){n='<div data-from="0" class="gt_page">1</div>',n+='<div class="gt_page_dots">...</div>';for(var p=c-1;e>p;++p){var i=p*s,_=p-1,u=p+1;l===u&&(r=_*s,0>_&&(r=(e-1)*s),d=u*s,u===e&&(d=0),a=SELECTED),n+='<div data-from="'+i+'" class="gt_page '+a+'">'+(p+1)+"</div>",a=""}break}}else l===u&&(a=SELECTED),n+='<div data-from="'+i+'" class="gt_page '+a+'">'+u+"</div>";a=""}return'<div class="gt_pagn"><div data-from="'+r+'" class="gt_page prev">'+language.prev+"</div>"+n+'<div data-from="'+d+'" class="gt_page next">'+language.next+"</div></div>"}function setTableSort(e,t){var s="",o=t,n=parseInt(e.defaultPerPage)+parseInt(e.fromRow),n=0;n=o.length>e.defaultPerPage?parseInt(e.defaultPerPage)+parseInt(e.fromRow):o.length;var a=settings.tbody.find("tr.active"),i=[];typeof a!==UNDEFINED&&a.each(function(){var e=$(this).attr("gte-row-id");i[e]=e});for(var r=e.fromRow;n>r;++r){var d=0,l="";if(typeof o[r].GT_RowId!==UNDEFINED)d=o[r].GT_RowId;else{if(typeof o[r].id===UNDEFINED)return void console.error('You have neither "GT_RowId" nor "id" in json structure.');d=o[r].id}i.length>0&&typeof i[d]!==UNDEFINED&&(l="active"),s+='<tr class="'+l+'" gte-row-id="'+d+'">';for(var c in o[r])"GT_RowId"!==c&&invisibleCols[c]===!0&&(s+='<td data-name="'+c+'">'+o[r][c]+"</td>");s+="</tr>"}e.tbody.html(s),clearTimeout(sortTimeout),setSelectRows(e)}function setTableRows(e,t,s){var o="",n=t;typeof s!==UNDEFINED&&(n=s);var a=0;a=n.length>e.defaultPerPage?parseInt(e.defaultPerPage)+parseInt(e.fromRow):n.length;var i=settings.tbody.find("tr.active"),r=[];typeof i!==UNDEFINED&&i.each(function(){var e=$(this).attr("gte-row-id");r[e]=e});for(var d=e.fromRow;a-1>d&&typeof n[d]!==UNDEFINED;d++){var l=0,c="";if(typeof n[d].GT_RowId!==UNDEFINED)l=n[d].GT_RowId;else{if(typeof n[d].id===UNDEFINED)return void console.error('You have neither "GT_RowId" nor "id" in json structure.');l=n[d].id}r.length>0&&typeof r[l]!==UNDEFINED&&(c="active"),o+='<tr class="'+c+'" gte-row-id="'+l+'">';var g=settings.columnOpts;if(g.length>0){var _=0,u="";for(var p in n[d]){if("GT_RowId"!==p&&invisibleCols[p]===!0){u=n[d][p];for(var h in g)if(typeof g[h].render!==UNDEFINED&&g[h].target===_){var f={id:l},v="string";u=g[h].render(u,f,v)}o+='<td data-name="'+p+'">'+u+"</td>"}++_}}else for(var p in n[d])"GT_RowId"!==p&&invisibleCols[p]===!0&&(o+='<td data-name="'+p+'">'+n[d][p]+"</td>");o+="</tr>"}e.tbody.html(o),clearTimeout(searchTimeout),setSelectRows(e),setPagination(e,t),setPgnSelect(settings,t),0===searchSet&&(setSearch(settings,t),searchSet=1),0===discreteSearchSet&&(setDiscreteSearch(settings,t),discreteSearchSet=1)}function setEditBtn(e){var t=settings.tableOpts.buttons[0].editor;e.removeClass("gte_btn_disabled"),e.off("click"),e.click(function(){t.triggerPopupEdit(settings);var e=settings.container.find(".gte_editor_popup");e.find(".gte_editor_title").text(language.gte_editor_popupheader_edit),e.find("#gte_sent_btn").text(language.gte_editor_sendbtn_update)})}function setDeleteBtn(e){var t=settings.tableOpts.buttons[0].editor;e.removeClass("gte_btn_disabled"),e.off("click"),e.click(function(){t.triggerPopupDelete(settings);var e=settings.container.find(".gte_editor_popup");e.find(".gte_editor_title").text(language.gte_editor_popupheader_delete),e.find("#gte_sent_btn").text(language.gte_editor_sendbtn_delete);var s="",o=0;settings.tbody.find("tr.active").each(function(){s+='<input type="hidden" name="ids[]" value="'+$(this).attr("gte-row-id")+'"/>',++o}),e.find("#gte_msg").html("Are You sure You wish to delete "+o+" rows?"),e.find("#gte_ids").html(s)})}function unsetEditBtn(e){e.addClass("gte_btn_disabled"),e.off("click")}function unsetDeleteBtn(e){e.addClass("gte_btn_disabled"),e.off("click")}function setSelectRows(e){e.tbody.children(":even").addClass("even"),e.tbody.children(":odd").addClass("odd"),$(document).keydown(function(e){17===e.which&&(t=!0),16===e.which&&(s=!0)}),$(document).keyup(function(){t=!1,s=!1});var t=!1,s=!1;e.tbody.children().click(function(){var o=$(this),n=o.siblings();if(t===!1&&s===!1)o.hasClass("active")?o.removeClass("active"):(that.find("tbody tr.active").removeClass("active"),o.addClass("active"));else if(t)o.hasClass("active")?o.removeClass("active"):o.addClass("active");else if(s){var a=o.siblings(".active:first"),i=o.siblings(".active:last"),r=a.index(),d=i.index(),l=o.index();if(o.addClass("active"),d===r)d>l?n.each(function(){var e=$(this),t=e.index();t>l&&d>t&&e.addClass("active")}):n.each(function(){var e=$(this),t=e.index();l>t&&t>d&&e.addClass("active")});else{var c=Math.abs(l-r),g=Math.abs(l-d);g>=c?n.each(function(){var e=$(this),t=e.index();l>t&&t>r&&e.addClass("active")}):n.each(function(){var e=$(this),t=e.index();t>l&&d>t&&e.addClass("active")})}}var _=o.hasClass("active")?1:0;n.each(function(){$(this).hasClass("active")&&++_});var u=e.container.find(".gte_button.edit"),p=e.container.find(".gte_button.remove");1===_?(setEditBtn(u),setDeleteBtn(p)):(unsetEditBtn(u),0===_?unsetDeleteBtn(p):setDeleteBtn(p))})}function setPagination(e,t){if(e.struct.pagination.length>0){var s=e.container.find(".gt_pagination"),o=t.length,n=parseInt(e.defaultPerPage),a=Math.ceil(o/n),i=e.fromRow?parseInt(e.fromRow):0,r=drawPagnButtons(a,i,n,s);s.remove();var d='<div class="gt_pagination"><div class="gt_pgn_ttl">'+language.showing+" "+(i+1)+" "+language.to+" "+(i+n)+" "+language.of+" "+o+" "+language.entries+'. </div><div class="gt_pgn_pages">'+r+'</div><div class="clear"></div></div>';-1!==e.struct.pagination.indexOf("top")&&e.headTools.after(d),-1!==e.struct.pagination.indexOf("bottom")&&e.footTools.before(d),e.container.find(".gt_page").click(function(){var s=$(this);e.fromRow=parseInt(s.attr("data-from")),setTableRows(e,t)})}}var PERIOD_SEARCH=250,SORT_ASC="asc",SORT_DESC="desc",POSITION_TOP="top",POSITION_BOTTOM="bottom",UNDEFINED="undefined",SELECTED="selected",CHECKED="checked",that=this,json=null,struct={},language=[],invisibleCols=[],unsearchableCols=[],searchSet=0,discreteSearchSet=0,sortTimeout=null,searchTimeout=null,lastTimeKeyup=(new Date).getTime(),nowMillis=0;struct.search=[],typeof options.struct.search===UNDEFINED?struct.search=[POSITION_TOP]:options.struct.search.length>0&&(struct.search=options.struct.search),struct.rowsSelector=[],typeof options.struct.rowsSelector===UNDEFINED?struct.rowsSelector=[SORT_ASC,POSITION_TOP,POSITION_BOTTOM]:options.struct.rowsSelector.length>0&&(struct.rowsSelector=options.struct.rowsSelector),struct.pagination=[],typeof options.struct.pagination===UNDEFINED?struct.pagination=["bottom"]:options.struct.pagination.length>0&&(struct.pagination=options.struct.pagination);var langs={en:{gte_editor_popupheader_delete:"Delete",gte_editor_popupheader_edit:"Edit",gte_editor_popupheader_create:"Create row",gte_editor_sendbtn_create:"Create",gte_editor_sendbtn_update:"Update",gte_editor_sendbtn_delete:"Delete",show:"Show",entries:"entries",showing:"Showing",to:"to",of:"of",prev:"Previous",next:"Next",search:"Search",editor_create:"New",editor_edit:"Edit",editor_remove:"Delete"},gr:{gte_editor_popupheader_delete:"Löschen",gte_editor_popupheader_edit:"Bearbeiten",gte_editor_popupheader_create:"Neu zeile",gte_editor_sendbtn_create:"",gte_editor_sendbtn_update:"",gte_editor_sendbtn_delete:"",show:"Zeigen",entries:"einträge",showing:"Zeigen",to:"bis",of:"von",prev:"früher",next:"Nächste",search:"Suche",editor_create:"Neu",editor_edit:"Bearbeiten",editor_remove:"Löschen"},ru:{gte_editor_popupheader_delete:"Удалить",gte_editor_popupheader_edit:"Редактировать",gte_editor_popupheader_create:"Создать строку",gte_editor_sendbtn_create:"Создать",gte_editor_sendbtn_update:"Сохранить",gte_editor_sendbtn_delete:"Удвлить",show:"Показать",entries:"строк",showing:"Показано от",to:"до",of:"из",prev:"Пред.",next:"След.",search:"Поиск",editor_create:"Создать",editor_edit:"Редактировать",editor_remove:"Удалить"},fr:{gte_editor_popupheader_delete:"Effacer",gte_editor_popupheader_edit:"éditer",gte_editor_popupheader_create:"Créer rangée",gte_editor_sendbtn_create:"",gte_editor_sendbtn_update:"",gte_editor_sendbtn_delete:"",show:"Montrer",entries:"entrées",showing:"Projection",to:"à",of:"de",prev:"Précédent",next:"Suivant",search:"Recherche",editor_create:"Créer",editor_edit:"éditer",editor_remove:"Effacer"},es:{gte_editor_popupheader_delete:"Borrar",gte_editor_popupheader_edit:"Editar",gte_editor_popupheader_create:"Crear fila",gte_editor_sendbtn_create:"",gte_editor_sendbtn_update:"",gte_editor_sendbtn_delete:"",show:"Mostrar",entries:"Entradas",showing:"Demostración",to:"a",of:"de",prev:"Anterior",next:"Próximo",search:"Buscar",editor_create:"Crear",editor_edit:"Editar",editor_remove:"Borrar"},ch:{gte_editor_popupheader_delete:"删除",gte_editor_popupheader_edit:"编辑",gte_editor_popupheader_create:"创建行",gte_editor_sendbtn_create:"",gte_editor_sendbtn_update:"",gte_editor_sendbtn_delete:"",show:"显示",entries:"项目",showing:"显示",to:"至",of:"的",prev:"前",next:"未来",search:"搜索",editor_create:"创造",editor_edit:"编辑",editor_remove:"删除"},hi:{gte_editor_popupheader_delete:"हटाना",gte_editor_popupheader_edit:"संपादन करना",gte_editor_popupheader_create:"पंक्ति बना",gte_editor_sendbtn_create:"",gte_editor_sendbtn_update:"",gte_editor_sendbtn_delete:"",show:"प्रदर्शन",entries:"आइटम",showing:"नुमाइश",to:"तक",of:"की",prev:"पूर्व",next:"अगला",search:"खोज",editor_create:"बनाना",editor_edit:"संपादन करना",editor_remove:"हटाना"}},settings=$.extend(!0,{styling:{color:"#333",bgColor:"#ccc",highlightColor:"orange"},struct:struct,lang:"en",perPageRows:[25,50,100,200,500],defaultPerPage:25,columns:[],columnOpts:[],tableOpts:{buttons:[],theme:"std"}},options);switch(settings.lang){case"gr":language=langs.gr;break;case"ru":language=langs.ru;break;case"fr":language=langs.fr;break;case"hi":language=langs.hi;break;case"ch":language=langs.ch;break;case"es":language=langs.es;break;default:language=langs.en}var thead=that.children(":first"),tfoot=that.children(":last"),headThs=thead.children().children(),footThs=tfoot.children().children(),cntCols=headThs.length;that.wrap('<div class="gt_container"></div>');var container=that.parent().parent().find(".gt_container").prepend('<div class="gt_head_tools"></div>'),headTools=that.parent().parent().find(".gt_head_tools");container.append('<div class="gt_foot_tools"></div>');var footTools=container.find(".gt_foot_tools");if(settings.struct.rowsSelector.length>0){var options=language.show+' <select class="gt_select" name="per_page_rows">';for(var k in settings.perPageRows){var rows=settings.perPageRows[k];options+="<option "+(settings.defaultPerPage===rows?'selected=""':"")+' value="'+rows+'">'+rows+"</option>"}options+="</select> "+language.entries,-1!==settings.struct.rowsSelector.indexOf("top")&&headTools.append('<div class="gt_rows_selector">'+options+"</div>"),-1!==settings.struct.rowsSelector.indexOf("bottom")&&footTools.append('<div class="gt_rows_selector">'+options+"</div>")}return settings.struct.search.length>0&&headTools.append('<div class="gt_main_search"><input type="text" class="gt_search" value="" placeholder="'+language.search+'" /></div>'),headTools.append('<div class="clear"></div>'),footTools.append('<div class="clear"></div>'),that.addClass("gigatable"),thead.addClass("gt_head"),tfoot.addClass("gt_foot"),thead.after('<tbody class="gt_body"><tr><td class="gt_loader" colspan="'+cntCols+'">Loading...</td></tr></tbody>'),settings.thead=thead,settings.tbody=thead.next(),settings.tfoot=tfoot,settings.headThs=headThs,settings.cntCols=cntCols,settings.headTools=headTools,settings.footTools=footTools,settings.container=container,settings.fromRow=0,$.ajax({url:settings.ajax,type:"GET",dataType:"json"}).done(function(e){if(json=e.rows?e.rows:e.row,typeof json===UNDEFINED)return console.error("Put json into rows or row associative key!"),!1;if(null!==json[0]&&Object.keys(json[0]).length!==cntCols&&Object.keys(json[0]).length!==cntCols+1||null===json[0]&&null!==json&&Object.keys(json).length!==cntCols)return console.error("You ought to adjust columns in thead and tfoot tags to json output!"),!1;var t=container.find("th");t.each(function(){var e=$(this),t=e.index();settings.columns[t].sortable!==!1&&e.addClass("sorting"),settings.columns[t].visible===!1?(e.hide(),invisibleCols[settings.columns[t].data]=!1):invisibleCols[settings.columns[t].data]=!0,settings.columns[t].searchable===!1?unsearchableCols[settings.columns[t].data]=!1:unsearchableCols[settings.columns[t].data]=!0}),tfoot.find("th").each(function(){var e=$(this),t=e.index();if(settings.columns[t].discreteSearch===!0){var s="Search in "+e.text();typeof settings.columns[t].discreteSearchValue!==UNDEFINED&&(s=settings.columns[t].discreteSearchValue(e.text()),e.removeClass("sorting")),e.html('<input type="text" placeholder="'+s+'" />')}}),setTableRows(settings,json),setSort(settings,json),settings.tableOpts.buttons.length>0&&setButtons(settings);var s=that.width();container.css("width",s+40+"px")}),this}}(jQuery);